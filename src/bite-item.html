<dom-module is="bite-item">
  <template>
    <style>
      .itemContainer {
        position: relative;
      }
      .item {
        display: block;
        padding: 10px;
        height: 72px;
      }
      .infoContainer {
        display: block;
        height: 100%;
        width: 100%;
      }
      .image {
        float: left;
        margin-top: 12px;
        color: #292E35;
        font-size: 32px;
      }
      .namePrice {
        display: block;
        margin-top: 17px;
        float: left;
        width: 150px;
        margin-left: 17px;
      }
      .name {
        float: left;
        width: 150px;
        color: #292E35;
        font-family: Compasse;
      }
      .price {
        float: left;
        color: black;
        opacity: 0.54;
        font-family: Compasse;
      }
      .actions {
        margin-top: 17px;
        float: right;
        display: block;
      }
      .add, .remove {
        float: left;
        width: 24px;
        height: 24px;
      }
      .add {
        margin-right: 8px;
      }
      .remove {
        margin-left: 8px;
      }
      .total {
        float: left;
        font-family: Compasse;
        font-size: 16px;
        font-weight: 800;
        margin-top: 12px;
        margin-left: 10px;
      }
      paper-icon-button{
        color: #9b9b9b;
      }
    </style>

    <div class="itemContainer">
      <div class="item" on-tap="_itemClick">
        <paper-ripple centers fit style="color:lightgrey;"></paper-ripple>
        <div class="infoContainer">
          <div class="image">üçü</div>
          <div class="namePrice">
            <div class="name">[[name]]</div>
            <div class="price">[[price]]</div>
          </div>
          <div class="actions">
            <div class="add"><paper-icon-button icon="remove" mini></paper-icon-button></div>
            <div class="total">[[amount]]</div>
            <div class="remove"><paper-icon-button icon="add" mini></paper-icon-button></div>
          </div>
        </div>
      </div>
    </div>
  </template>
  <script>
    Polymer({
      is: 'bite-item',
      properties: {
        product: {
          type: String
        },
        storeid: {
          type: String,
          observer: '_storeIdChanged'
        },
        name: String,
        key: {
            type: String,
            observer: '_keyChanged'
        },
        uid: {
            type: String,
            observer: '_uidChanged'
        },
        amount: Number
      },
      _storeIdChanged: function () {
        this._getData();
      },

      _keyChanged: function () {
        this._getData();
      },

      _uidChanged: function () {
        this._getData();
      },

      _itemClick: function () {
        console.log(this.product);
        this._setUserOrder();
      },

      _getData: function () {
        if(this.storeid == undefined || this.key == undefined || this.uid == undefined) return;
        console.log("GET DATA");
        this._getOrder();
        this._getUserOrder();
      },

      _getOrder: function () {
        var that = this;
        var productsRef = firebase.database().ref('products/'+that.storeid+'/products/'+that.product);
        productsRef.on('value', function(snapshot) {
          if(snapshot.val() == null) return;
          that.name = snapshot.val().name;
          that.price = snapshot.val().price;
        });
      },

      _getUserOrder: function () {
        var that = this;
        var userOrderRef = firebase.database().ref('user_order/'+that.key+'/'+that.uid+'/'+that.product);
        userOrderRef.on('value', function(snapshot){
          if(snapshot.val() == null){
              that.amount = 0;

              //HIDE THIS GUY

              return
          }
          that.amount = snapshot.val().amount;
        });
      },

      _setUserOrder: function () {
        var that = this;
        that.amount++;
        firebase.database().ref('user_order/'+that.key+"/"+that.uid+"/"+that.product).set({
          amount: that.amount
        });
      }
    });
  </script>
</dom-module>
