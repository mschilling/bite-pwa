<link rel="import" href="../bower_components/polymer/polymer.html">
<link rel="import" href="../bower_components/paper-icon-button/paper-icon-button.html">
<link rel="import" href="../bower_components/paper-card/paper-card.html">
<link rel="import" href="../bower_components/paper-ripple/paper-ripple.html">
<link rel="import" href="bite-card.html">


<dom-module id="bite-main">
    <template>
        <style>
            :host{
                margin: 0 auto;
                display: block;
            }
            .logoImg{
                width: 100px;
                bottom: 20px;
                left: 20px;
                position: fixed;
            }

            .orderFab{
                bottom: 20px;
                right: 20px;
                position: fixed;
                background-color: #EC9630;
                z-index: 1;
            }

            .container{
                max-width: 800px;
                margin: 0 auto;
                color: #EC9630;
            }

            /* Ranking card styling */

            .cardImg{
                float: left;
                border-radius: 50%;
                background: url(../images/trophy.png);
                width: 50px;
                height: 50px;
                background-repeat: no-repeat;
                background-position: center center;
                background-size: cover;
                margin-left: 8px;
                margin-right: 16px;
                margin-bottom: 16px;
            }

            .cardTitleDesc{
                display: block;
                float: left;
            }

            .cardTitle{
                display: block;
                font-weight: 700;
                font-style: italic;
                font-size: 16px;
                margin-right: 10px;
                margin-top: 8px;
            }

            .cardDesc{
                display: block;
                font-weight: 100;
                margin-top: 8px;
                font-size: 14px;
                color: #9B9B9B;
            }

            .navRanking{
                float: right;
                margin-top: 8px;
            }

            .cardContainer {
                display: block;
                margin: 0 auto;
                text-align: center;
                width: 100%;
            }

            .cardRank{
                margin: 0 auto;
                width: 90%;
                margin-top: 16px;
                text-align: left;
                font-size: 16px;

                --paper-card-actions:{
                    padding: 0;
                }
            }


            .bites{
                margin: 0 auto;
                display: block;
                width:100%;
            }

            .biteLine{
                margin: 0 auto;
                height: 2px;
                background-color: #EC9630;
                margin-top: 8px;
                width: 90%;

            }

            .biteTitle{
                font-family: Roboto, Noto, sans-serif;
                font-style: italic;
                font-weight: 700;
                font-size: 20px;
                text-align: left;
                width: 90%;
                margin: 0 auto;
                margin-top: 24px;
            }
            iron-icon {
                color: var(--app-primary-color);
            }

            app-toolbar{
                color: var(--app-text-color);
            }

            .bite-cards {
                margin-bottom: 10px;
            }

            .emptyBites {
                width: 90%;
                margin: 0 auto;
                z-index: 2;
            }
            .emptyImage{
                margin-top: 32px;
            }
            .emptyTitle, .emptyText {
                color: #000000;
                opacity: 0.4;
            }
            .emptyTitle{
                margin-top: 32px;
                font-style: italic;
                font-weight: 800;
                font-size: 16px;
            }
            .emptyText {
                margin-top: 16px;
                margin-bottom: 100px;
            }
            paper-ripple{
                color: lightgrey;
            }
        </style>

        <img src="../images/bite.png" alt="bite" class="logoImg" style="z-index: -1;">
        <paper-fab class="orderFab" icon="add" on-tap="_addBite"></paper-fab>


        <div class="container">
            <div class="cardContainer">
                <paper-card class="cardRank">
                    <paper-ripple centers fit recenters></paper-ripple>
                    <div class="card-content">
                        <div class="cardImg"></div>
                        <div class="cardTitleDesc">
                            <div class="cardTitle">RANGLIJSTEN</div>
                            <div class="cardDesc">Je staat op de 10e plaats!</div>
                        </div>
                        <div class="navRanking"><paper-icon-button icon="arrow-forward" style="color: #E98B2B;" ></paper-icon-button></div>
                    </div>
                </paper-card>


                <div class="bites">
                    <div class="biteTitle">BITES ([[biteTotal]])</div>
                    <div class="biteLine"></div>
                </div>
                <div id="cards" class="bite-cards">
                    <!-- Bites are added here dynamically -->
                    <template is="dom-repeat" items="{{key}}" as="key">
                        <bite-card key="[[key]]" clickedStoreId="{{clickedStoreId}}" on-tap="_navJoin"></bite-card>
                    </template>

                    <div class="emptyBites">
                    <!-- Only show when Bites is empty -->
                        <div class="emptyImage"><img src="../images/Bitegrey.png"/></div>
                        <div class="emptyTitle">HONGER!</div>
                        <div class="emptyText">Er staan momenteel geen BITES open.<br/>
                            Je kunt zelf een nieuwe BITE openen
                            door op de plus te tikken!</div>
                    </div>
                </div>
            </div>
        </div>
    </template>


    <script>
        Polymer({
            is: 'bite-main',

            properties:{
                biteTotal: {
                    type: Number,
                    value: 0
                },
                user: {
                    type: Object
                },
                biteUserName: {
                    type: String
                },
                joinBite: {
                    type: Object,
                    observer: '_changedJoinBite'
                },
                key: {
                    type: Array
                }
            },

            _addBite: function () {
                //TODO
                console.log("TODO");
            },

            _openBite: function(){

            },

            ready: function(){
                this._getOrders();
                var empty = Polymer.dom(this.root).querySelector('.emptyBites');


                //Hide emptybites text when key Array is not empty
                if(this.key !== null){
                    empty.setAttribute('style', 'display:none;');
                } else {
                    empty.setAttribute('style', 'display:visible;');
                }

            },

            _cardClick: function(e){
                var args = Polymer.dom(e).path[2].getAttribute('data-args').split(',');
                console.log(args[0]);
            },

            _changedJoinBite: function(){
                console.log(this.joinBite);
            },

            _getOrders: function(){
                var that = this;
                var orderRef = firebase.database().ref('orders/');
                orderRef.on('value', function(snapshot){
                    that.key = [];
                    snapshot.forEach(function (childSnapshot) {
                        that.push('key', childSnapshot.key);
                        that.biteTotal = that.key.length;
                    });
                });

            },

          _navJoin: function(e){
            console.log("You pressed the card with order key: "+ e.model.key);

            this.fire('click-order', e.model.key);
          }






        });
    </script>
</dom-module>
